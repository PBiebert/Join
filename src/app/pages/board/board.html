<main>
  <div class="board__outer">
    <div class="board-main-container board-mobile-nav">
      <app-nav></app-nav>

      <div class="board-wrapper">
        <!-- Header -->
        <app-header></app-header>

        <!-- Board Content -->
        <div class="board-content">
          <div class="board-inner">
            <!-- Board Titel + Suchfeld + Add-Button -->
            <div class="board-header">
              <h1>Board</h1>
              <div class="board-actions">
                <div class="search-box">
                  <input type="text" placeholder="Find Task" (input)="onSearch($event)" />
                  <img src="assets/icons/search.svg" alt="Search" />
                </div>
                @if (!tasksService.smallView) {
                  <button class="btn-primary" (click)="tasksService.openAddTaskDialog('To do')">
                    Add task <img src="assets/icons/plus-pure.svg" alt="Add Icon" class="plus-pure">
                  </button>
                } @else {
                  <button class="btn-primary" [routerLink]="['/add-task']">
                    Add task <span>+</span>
                  </button>
                }
              </div>
            </div>

            <!-- Board Spalten: cdkDropListGroup verbindet alle Spalten -->
            <div class="board-columns" cdkDropListGroup>
              <!-- Spalte: To do -->
              <div class="board-column">
                <div class="column-header">
                  <h2>To do</h2>
                  @if (!tasksService.smallView) {
                    <button class="add-task-btn" (click)="tasksService.openAddTaskDialog('To do')">
                      <img src="assets/icons/plus.svg" alt="Add Task" />
                    </button>
                  } @else {
                    <button class="add-task-btn" [routerLink]="['/add-task']">
                      <img src="assets/icons/plus.svg" alt="Add Task" />
                    </button>
                  }
                </div>

                <div
                  class="column-content"
                  cdkDropList
                  id="To do"
                  [cdkDropListData]="todoTasks"
                  (cdkDropListDropped)="onTaskDrop($event)"
                >
                  @for (task of todoTasks; track task.id) {
                    <app-single-task-card
                      cdkDrag
                      [cdkDragStartDelay]="isMobile ? 500 : 0"
                      [cdkDragData]="task"
                      [task]="task"
                      (taskClicked)="openTaskDialog($event)"
                    >
                    </app-single-task-card>
                  }

                  @if (todoTasks.length === 0) {
                    <div class="empty-state">No tasks To do</div>
                  }
                </div>
              </div>

              <!-- Spalte: In progress -->
              <div class="board-column">
                <div class="column-header">
                  <h2>In progress</h2>
                  @if (!tasksService.smallView) {
                    <button
                      class="add-task-btn"
                      (click)="tasksService.openAddTaskDialog('In progress')"
                    >
                      <img src="assets/icons/plus.svg" alt="Add Task" />
                    </button>
                  } @else {
                    <button class="add-task-btn" [routerLink]="['/add-task']">
                      <img src="assets/icons/plus.svg" alt="Add Task" />
                    </button>
                  }
                </div>

                <div
                  class="column-content"
                  cdkDropList
                  id="In progress"
                  [cdkDropListData]="inProgressTasks"
                  (cdkDropListDropped)="onTaskDrop($event)"
                >
                  @for (task of inProgressTasks; track task.id) {
                    <app-single-task-card
                      cdkDrag
                      [cdkDragStartDelay]="isMobile ? 500 : 0"
                      [cdkDragData]="task"
                      [task]="task"
                      (taskClicked)="openTaskDialog($event)"
                    >
                    </app-single-task-card>
                  }

                  @if (inProgressTasks.length === 0) {
                    <div class="empty-state">No tasks In progress</div>
                  }
                </div>
              </div>

              <!-- Spalte: Await feedback -->
              <div class="board-column">
                <div class="column-header">
                  <h2>Await feedback</h2>
                  @if (!tasksService.smallView) {
                    <button
                      class="add-task-btn"
                      (click)="tasksService.openAddTaskDialog('Await feedback')"
                    >
                      <img src="assets/icons/plus.svg" alt="Add Task" />
                    </button>
                  } @else {
                    <button class="add-task-btn" [routerLink]="['/add-task']">
                      <img src="assets/icons/plus.svg" alt="Add Task" />
                    </button>
                  }
                </div>

                <div
                  class="column-content"
                  cdkDropList
                  id="Await feedback"
                  [cdkDropListData]="awaitFeedbackTasks"
                  (cdkDropListDropped)="onTaskDrop($event)"
                >
                  @for (task of awaitFeedbackTasks; track task.id) {
                    <app-single-task-card
                      cdkDrag
                      [cdkDragStartDelay]="isMobile ? 500 : 0"
                      [cdkDragData]="task"
                      [task]="task"
                      (taskClicked)="openTaskDialog($event)"
                    >
                    </app-single-task-card>
                  }

                  @if (awaitFeedbackTasks.length === 0) {
                    <div class="empty-state">No tasks awaiting feedback</div>
                  }
                </div>
              </div>

              <!-- Spalte: Done -->
              <div class="board-column">
                <div class="column-header">
                  <h2>Done</h2>
                  @if (!tasksService.smallView) {
                    <button class="add-task-btn" (click)="tasksService.openAddTaskDialog('Done')">
                      <img src="assets/icons/plus.svg" alt="Add Task" />
                    </button>
                  } @else {
                    <button class="add-task-btn" [routerLink]="['/add-task']">
                      <img src="assets/icons/plus.svg" alt="Add Task" />
                    </button>
                  }
                </div>

                <div
                  class="column-content"
                  cdkDropList
                  id="Done"
                  [cdkDropListData]="doneTasks"
                  (cdkDropListDropped)="onTaskDrop($event)"
                >
                  @for (task of doneTasks; track task.id) {
                    <app-single-task-card
                      cdkDrag
                      [cdkDragStartDelay]="isMobile ? 500 : 0"
                      [cdkDragData]="task"
                      [task]="task"
                      (taskClicked)="openTaskDialog($event)"
                    >
                    </app-single-task-card>
                  }

                  @if (doneTasks.length === 0) {
                    <div class="empty-state">No tasks Done</div>
                  }
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Task-Detail-Dialog: Erscheint, wenn activeTask gesetzt ist -->
  <app-single-task-dialog></app-single-task-dialog>
</main>
<app-add-task-dialog></app-add-task-dialog>
