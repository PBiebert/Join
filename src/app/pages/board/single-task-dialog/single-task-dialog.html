@if (task) {
  <!-- Overlay: Dunkler Hintergrund, Klick = Dialog schließen -->
  <div class="dialog-overlay" (click)="closeDialog()">

    <!-- Karte: stopPropagation verhindert Schließen bei Klick ins Innere -->
    <div
      class="dialog-card"
      [class.card-slide-in]="!isClosing"
      [class.card-slide-out]="isClosing"
      (click)="onDialogContentClick($event)">

      <!-- Header: Close Button -->
      <div class="dialog-header">
        <!-- Category Badge -->
        <span class="task-badge" [ngClass]="badgeClass">
          {{ task.category }}
        </span>

        <button class="close-btn" (click)="closeDialog()" aria-label="Close Dialog">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M18 6L6 18M6 6L18 18" stroke="#2A3647" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <!-- Task Title -->
      <h1 class="task-title">{{ task.title }}</h1>

      <!-- Task Description -->
      <p class="task-description">{{ task.description }}</p>

      <!-- Due Date Section -->
      <div class="info-section">
        <span class="info-label">Due date:</span>
        <span class="info-value">{{ formattedDueDate }}</span>
      </div>

      <!-- Priority Section -->
      <div class="info-section">
        <span class="info-label">Priority:</span>
        <div class="priority-container">
          <span class="info-value">{{ task.priority }}</span>
          <img [src]="priorityIcon" [alt]="task.priority" class="priority-icon">
        </div>
      </div>

      <!-- Assigned To Section -->
      @if (assignedUsers.length > 0) {
        <div class="info-section-assigned">
          <span class="info-label">Assigned To:</span>
          <div class="assigned-list">
            @for (user of assignedUsers; track user.id) {
              <div class="assigned-user">
                <div class="avatar-large" [ngClass]="user.color">
                  {{ user.initials }}
                </div>
                <span class="user-name">{{ user.name }}</span>
              </div>
            }
          </div>
        </div>
      }

      <!-- Subtasks Section -->
      @if (task.subtasks && task.subtasks.length > 0) {
        <div class="info-section-subtasks">
          <span class="info-label">Subtasks</span>
          <div class="subtasks-list">
            @for (subtask of task.subtasks; track subtask.id) {
              <label class="subtask-item" (click)="onSubtaskToggle(subtask.id, subtask.completed)">
                <div class="custom-checkbox" [class.checked]="subtask.completed">
                  @if (subtask.completed) {
                    <img src="assets/icons/checked_checkbox.svg" alt="checked">
                  } @else {
                    <img src="assets/icons/empty-checkbox.svg" alt="unchecked">
                  }
                </div>
                <span class="subtask-title" [class.completed]="subtask.completed">
                  {{ subtask.title }}
                </span>
              </label>
            }
          </div>
        </div>
      }

      <!-- Footer: Delete & Edit Buttons -->
      <div class="dialog-footer">
        <button class="btn-delete" (click)="onDeleteTask()">
          <img src="assets/icons/delete.svg" alt="Delete" width="24" height="24">
          Delete
        </button>

        <!-- Divider -->
      <div class="button-divider"></div>

        <button class="btn-edit" disabled>
          <img src="assets/icons/edit.svg" alt="Edit" width="24" height="24">
          Edit
        </button>
      </div>
    </div>
  </div>
}